## 地址空间

主存中的每个字节都由一个整数物理地址所指定，物理地址的集合叫做*物理地址空间*。它的范围通常为0到`N-1`，其中`N`是主存的大小。

许多操作系统提供虚拟内存，也就是说程序永远不需要处理物理地址，也不需要知道有多少物理内存是有效的。作为代替，*程序处理虚拟地址*，它被编码为从0到`M-1`，其中`M`是有效虚拟地址的大小。虚拟地址空间的大小取决于所处的操作系统和硬件。

Q：为什么32位操作系统给进程分配的是4G的虚拟地址空间？A：32位操作系统一共有32根地址线，每个地址线能模拟的数字位0/1。

### 虚拟内存

传统：一次性和驻留性，

虚拟内存：多次性对换性虚拟性

局部性原理：块表、页高速缓存及虚拟内存技术使用高速缓存技术，高速缓存技术依赖局部性原理

1. 空间局部性、时间局部性

2. 虚拟内存技术建立了内存-外存两极存储结构，利用局部性原理实现高速缓存

虚拟内存的实现

1. 一定容量的内存和外存

2. 页表机制，离散分配

3. 中断机构：缺页内部异常，缺页进程阻塞，调页完成唤醒。

4. 地址变换机构（需要硬件支持）

容量：**虚拟存储器的容量（地址空间）由计算机地址总线的数量来决定**。虚拟存储器的页表是虚地址到内存地址或者外存地址的映射。通过页表项的`status`位来决定。缺页中断将外存中的块置入内存。

虚存实际容量由CPU地址长度和外存容量决定。一般情况下CPU的地址长度能表示的大小都大于外存容量。

1. 当CPU的地址长度能表示的大小远远大于外存容量时，虚存的实际容量为内存和外存容量之和

2. 当外存容量远大于CPU字长能表示的大小时，虚存的实际容量由CPU字长决定

### 地址翻译

**地址变换机构是内存管理单元**`MMU`**中将逻辑地址映射为内存中物理地址的硬件系统。大多数处理器提供了内存管理单元**`MMU`**，位于CPU和主存之间。**`MMU`**在**`VA`**和**`PA`**之间执行快速的翻译。**

逻辑地址`logical address`是程序产生的与段相关的偏移地址部分。源代码经过complie编译：生成可执行代码，产生若干代码块Object Module后，目标程序所用的地址就是逻辑地址。逻辑地址的范围叫逻辑地址空间。物理地址`physical address`在CPU外部地址总线上的寻址物理内存的地址信号。物理地址用户透明，转换过程硬件自动完成，转换过程叫做地址重定位。

**当cache作用时：**

逻辑地址是由程序员给出的。经过查询快表页表得到物理地址。但此时的物理地址并不一定是最终地址，因为如果cache命中则需要再转换成cache地址。转换后的开始中的地址才是最终地址。但如果开始不命中，则仍需要按原来经过代表或者业表得到的地址去直接访存。得到物理地址（内存地址）后，先访问cache，如果命中，转换成cache地址访问，如果没命中，则进行访存。

