# 进程控制

- 创建原语`fork`：申请空白PCB-分配资源-初始化PCB-将PCB插入就绪队列

    - 事件：用户登录-作业调度-系统提供服务-应用请求

- 撤消原语：找到PCB-剥夺CPU-终止子进程-资源归还给父进程或操作系统-删除PCB

    - 事件：正常结束-异常结束-外界干预

- 阻塞原语block-P原语：找到PCB-保护进程运行现场，暂停进程运行-PCB挂入相应阻塞队列

    - 事件：等待系统资源-等待合作进程完成工作

- 唤醒原语wakeup-V原语：找到PCB-设置进程为就绪态-将PCB插入就绪队列

    - 事件：等待的事情发生

- 切换原语：将运行环境信息存入PCB-PCB移入相应队列-选择另一个进程执行，并更新其PCB-根据PCB恢复新进程所需的运行环境

    - 事件：当前进程时间片到-有更高优先级的进程到达-当前进程主动阻塞-当前进程终止

执行状态到阻塞状态是**主动**调用阻塞原语实现，阻塞状态到就绪状态的唤醒过程是被发现者进程调用唤醒原语的**被动**实现。

> **原语(primitives)**：进程控制用的程序段，执行期间不允许中断，它是一个不可分割的基本单位。
通过关中断指令和开中断指令实现原语的原子性，执行期间不会被中断。（特权指令，只能让内核使用）

# 线程控制

创建线程：调用`pthread_create()`

## 调度

### 类型时机

调度设计围绕计算机的首要资源CPU的高效利用展开，系统的运行性能在很大程度上取决于调度，调度是多道程序的关健。调度是决定资源分配给哪个进程的行为，是一种决策行为。切换是实际分配的行为，是执行行为。先有资源的调度，才有切换。

**作业调度-高级**，结果是创建了进程。按照一定原则从外存上处于后备状态的作业选择一个或者多个,分配内存,建立相应的进程，运行频率较低多道批处理系统一般配置了JS，而其他系统通常不需要配置。运行频率较低，通常为几分钟一次。

**交换调度-中级**，实际上是存储器管理的对换功能，将暂时不能运行的进程挂起suspend。**提高内存的利用率和系统的吞吐量**,将处于外存对换区的具备运行条件的进程调入内存,并将其状态修改为就绪态,挂在就绪态上等待.将暂不能运行的进程挂起。

**进程调度-低级**，结果是进程开始执行,进程调度的运行频率很高，一般隔几十毫秒就要运行一次。

调度时机：

合法调度时机：进程创建、进程结束、进程阻塞、IO中断、系统调用返回

非法调度时机：（需要置系统请求调度标志，在过程结束后进行响应的调度和切换）

中断处理过程中、进程在操作系统内核临界区、原子操作过程中

抢占式调度：遵循优先权，短进程有优先，时间片原则、提高系统吞吐率，响应效率

非抢占调度：分时系统和大多数实时系统，主动放弃处理机，实现简单，系统开销小

调度器本身也是一个程序，目的是为了给执行用户的程序提供资源，包含了一个决定一组程序中谁会赢得CPU时钟周期的算法。非抢占式的调度器中，一个进程要不然就一直执行到底，要不然就自己主动资源放弃处理器，以处理I/O请求，调度器只是安排先后顺序；而抢占式调度器里，调度器从当前进程手中把处理器抢走，交给另一个进程，有这么一个主动的动作。

### 调度算法

**FCFS：先来先服务-非剥夺-作业、进程**效率低，对短作业不利，不利于IO繁忙型作业，利用CPU繁忙型作业

**SJF：短作业优先-非剥夺、剥夺-作业、进程**

对长作业不利，长作业会饥饿，非剥夺不保证紧迫性作业被及时处理，时间是估计的

**HRRN：高响应比-非抢占、抢占-作业**

响应比=（作业等待时间+估计运行时间）/ 估计运行时间

综合了先来先服务和短作业优先的特点：等待时间相同，服务时间越短，响应比越高，SJF，服务时间相同，等待时间越长，响应比越高，FCFS，长作业作业响应比可以随等待时间增加而提高，克服了饥饿现象

**priority level优先级调度算法-非抢占、抢占-作业、进程**

静态优先级：系统进程>用户进程，交互进程>非交互进程（前台>后台），IO进程>计算型进程，时长越长优先级越低

动态优先级：优先级会在进程执行过程中动态变化调整。占有CPU时间、等待CPU时间作为参考

**Round-Robin时间片轮转-抢占-分时系统进程**

时间片的大小确定：系统响应时间：T=N×q q是时间片的大小，N为进程数，进程数一定，时间片和系统响应时间成正比.进程数：系统响应时间一定，进程数和时间片的大小成反比.系统的处理能力

**Multilevel Feedback Queue Scheduling多级反馈队列调度-抢占-RR和优先级的综合与发展**

多个就绪队列，各队列的时间片不同，优先级越高，时间片越小，通常是上一级的两倍。每个队列采FCFS

切换CPU到另一个进程，需要保存当前进程状态，并恢复另一个进程的状态，这个任务称为上下文切换。上下文是指某一时刻，CPU寄存器和程序计数器的内容。他需要相当可观的CPU时间。有的处理器提供多个寄存器组，这样上下文切换就只需要改变当前寄存器组的指针。模式切换是指用户态和内核态的切换。

调度是决定资源分配给哪个进程的行为，是一种决策行为。切换是实际分配的行为，是执行行为。先有资源的调度，才有切换。



‍

