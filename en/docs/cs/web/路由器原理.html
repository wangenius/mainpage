<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cs/web/路由器原理" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">路由器原理 | Panovista</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wangenius.github.io/en/docs/cs/web/路由器原理"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="路由器原理 | Panovista"><meta data-rh="true" name="description" content="‍---"><meta data-rh="true" property="og:description" content="‍---"><link data-rh="true" rel="icon" href="/en/img/panovista.svg"><link data-rh="true" rel="canonical" href="https://wangenius.github.io/en/docs/cs/web/路由器原理"><link data-rh="true" rel="alternate" href="https://wangenius.github.io/en/docs/cs/web/路由器原理" hreflang="en"><link data-rh="true" rel="alternate" href="https://wangenius.github.io/docs/cs/web/路由器原理" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://wangenius.github.io/docs/cs/web/路由器原理" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Panovista RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Panovista Atom Feed">






<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/en/assets/css/styles.9d024903.css">
<script src="/en/assets/js/runtime~main.953a672d.js" defer="defer"></script>
<script src="/en/assets/js/main.dd2a9a25.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/panovista.png" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/panovista.png" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">panovista</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">DSA</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/dsa/ds/概述">算法和数据结构</a></li><li><a class="dropdown__link" href="/en/docs/dsa/leetcode/字符串相关/公共字段">leetcode刷题</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">计算机原理</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/cs/co/概述">组成原理</a></li><li><a class="dropdown__link" href="/en/docs/cs/db/SQL">数据库</a></li><li><a class="dropdown__link" href="/en/docs/cs/os/概述">操作系统</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/en/docs/cs/web/LAN和以太网">计算机网络</a></li><li><a class="dropdown__link" href="/en/docs/more/git/安装和设置">Git</a></li><li><a class="dropdown__link" href="/en/docs/cs/si/生命周期模型">软件工程</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">语言</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/lang/cpp/简介">C++</a></li><li><a class="dropdown__link" href="/en/docs/lang/python/概述">Python</a></li><li><a class="dropdown__link" href="/en/docs/lang/rust/简介">Rust</a></li><li><a class="dropdown__link" href="/en/docs/lang/ts/CSS">TypeScript</a></li><li><a class="dropdown__link" href="/en/docs/lang/compile/概述">编译原理</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">更多</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/more/math/space">数学</a></li><li><a class="dropdown__link" href="/en/docs/more/tools/scoop">工具和工作流</a></li></ul></div><a class="navbar__item navbar__link" href="/en/docs/opus/overview">作品集</a><a class="navbar__item navbar__link" href="/en/blog">博客</a><a class="navbar__item navbar__link" href="/en/docs/about/关于我">关于</a><a href="https://github.com/wangenius/wangenius.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/en/"><img src="/en/img/panovista.png" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/panovista.png" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>panovista</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/LAN和以太网">LAN和以太网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/TCP">TCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/overview">overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/介质访问控制和帧">介质访问控制和帧</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/en/docs/cs/web/应用层协议">应用层协议</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/cs/web/应用层协议/DNS协议">DNS协议</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/cs/web/应用层协议/FTP">FTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/cs/web/应用层协议/HTTP">HTTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/cs/web/应用层协议/邮件系统">邮件系统</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/物理信道传输原理和静态复用">物理信道传输原理和静态复用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/网络IP地址和IP数据报">IP层</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/网络模型结构">网络模型结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/cs/web/网络设备">hub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/en/docs/cs/web/路由器原理">路由器原理</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">路由器原理</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>路由器原理</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="---siderbar_position--3">‍---
siderbar_position : 3<a href="#---siderbar_position--3" class="hash-link" aria-label="Direct link to ‍---
siderbar_position : 3" title="Direct link to ‍---
siderbar_position : 3">​</a></h2>
<h1>路由器</h1>
<ol>
<li>
<p>核心部件路由选择处理机。定期和相邻路由器交换路由信息不断的更新和维护路由表。</p>
</li>
<li>
<p>交换结构作用是根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的shuchuuuu端口转发出去。交换结构本身就是一种网络，但这种网络完全包含在路由器中。纵横交换结构：互连网络。</p>
</li>
</ol>
<p>路由表和转发表的区别：</p>
<ol>
<li>
<p>**转发：**就是路由器根据转发表把收到的IP数据报从路由器合适的端口转发出去。“转发”仅仅涉及一个路由器。</p>
</li>
<li>
<p>**路由选择：**则涉及很多路由器，路由表则是许多路由器协同工作的结果。这些路由器按照复杂的路由算法，得出整个网络的拓扑变化情况，因而能够动态地改变所选择的路由，并由此构造出整个的路由表。</p>
</li>
<li>
<p>**路由表：**一般仅包含从目的网络到下一跳（用IP地址表示）的映射而转发表是从路由表得出的。</p>
</li>
<li>
<p>**转发表：**必须包含完成转发功能所必需的信息。这就是说，在转发麦的每一行必须包含从要到达的目的  网络倒输出端口和某些 MAC 地址信息（如下一跳的以太网地址）的映射。</p>
</li>
<li>
<p>将转发表和路由表用不同的数据结构实现会带来一些好处，这是因为在转发分组时，转发表的结构应当使查找过程最优化，但路由表则需要对网络拓扑变化的计算最优化。路由表总是用软件实现的，但转发表则可用特殊的硬件来实现。请读者注意，在讨论路由选择的原理时，往往不去区分转发表和路由表的区别，而可以笼统地都使用路由表这一名词。</p>
</li>
</ol>
<p>‍</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="路由表和转发表的区别">路由表和转发表的区别？<a href="#路由表和转发表的区别" class="hash-link" aria-label="Direct link to 路由表和转发表的区别？" title="Direct link to 路由表和转发表的区别？">​</a></h3>
<ol>
<li>
<p><strong>转发</strong>：就是路由器根据转发表把收到的IP数据报从路由器合适的端口转发出去。“转发”仅仅涉及一个路由器。</p>
</li>
<li>
<p><strong>路由选择</strong>：则涉及很多路由器，路由表则是许多路由器协同工作的结果。这些路由器按照复杂的路由算法，得出整个网络的拓扑变化情况，因而能够动态地改变所选择的路由，并由此构造出整个的路由表。</p>
</li>
<li>
<p><strong>路由表</strong>：一般仅包含从目的网络到下一跳（用IP地址表示）的映射而转发表是从路由表得出的。</p>
</li>
<li>
<p><strong>转发表</strong>：必须包含完成转发功能所必需的信息。这就是说，在转发麦的每一行必须包含从要到达的目的网络倒输出端口和某些 MAC 地址信息（如下一跳的以太网地址）的映射。</p>
</li>
<li>
<p>将转发表和路由表用不同的数据结构实现会带来一些好处，这是因为在转发分组时，转发表的结构应当使查找过程最优化，但路由表则需要对网络拓扑 变化的计算最优化。路由表总是用软件实现的，但转发表则可用特殊的硬件来实现。请读者注意，在讨论路由选择的原理时，往往不去区分转发表和路由表的区别，而可以笼统地都使用路由表这一名词。</p>
</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="路由选择和分组转发">路由选择和分组转发<a href="#路由选择和分组转发" class="hash-link" aria-label="Direct link to 路由选择和分组转发" title="Direct link to 路由选择和分组转发">​</a></h3>
<p>控制层面根据路由选择协议所用的路由选择算法计算路由使用软件，一般是秒数量级。按照复杂的分布式算法，根据从各相邻路由器中所得到的关于整个网络拓扑的变化情况动态的改变所选择的路由。数据层面硬件转发，转发一个分组的时间是纳秒数量级。路由器间的信息也分为两类：主机间的转发数据和传送的路由信息。路由器之间交换路由信息，生成路由表，根据路由选择协议生成转发表，依靠多路由器协同工作。</p>
<h1>路由选择</h1>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是路由选择">什么是路由选择？<a href="#什么是路由选择" class="hash-link" aria-label="Direct link to 什么是路由选择？" title="Direct link to 什么是路由选择？">​</a></h3>
<p>路由算法就是让路由知道收到报文之后下一步怎么走。算法必须正确完整，计算简单，有自适应性，能适应通信量和网络拓扑的变化，具有稳定性，公平，最佳（相对某一种特定要求下得出的较为合理的选择）。互联网规模非常大，让所有的路由器知道所有的网络怎么到达不现实。许多单位不愿意将自己单位的网络的布局细节和本部门所采用的路由选择协议让外界知道。</p>
<p>自治系统AS： Autonomous System</p>
<ol>
<li>
<p>单一技术管理下的一组路由器，这些路由器使 用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由。</p>
</li>
<li>
<p>一个自治系统内的所有网络都由一个行政单位（政府部门，公司、大学）管辖，一个自治系统的所有路由器在自治系统内都是必须联通的。</p>
</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是rip">什么是<code>RIP</code>？<a href="#什么是rip" class="hash-link" aria-label="Direct link to 什么是rip" title="Direct link to 什么是rip">​</a></h3>
<p>[[RIP路由信息协议]] #距离向量 #IGP #应用层 #UDP<a href="https://juejin.cn/post/7022536969003466782" target="_blank" rel="noopener noreferrer">RIP原理</a>一种分布式的基于<strong>距离矢量算法</strong>的协议，它使用<strong>跳数</strong>作为度量来衡量到达目的网络的距离，路由器并不了解网络的拓扑。这是基于“<strong>传闻</strong>”的更新。<strong>优先选择跳数少的路径</strong>，不考虑带宽。RIP基于UDP，通过UDP报文进行路由信息的交换。RIP三个版本RIPv1、RIPv2、RIPng（为IPv6开发）。RIP版本1是<strong>广播发送</strong>，版本2是<strong>组播发送</strong>。RIP允许一条路经最多只能包含15个路由器，因此距离等于16时，表示网路不可达，防止数据报不断循环在环路上，减少拥堵的可能性。适用于小型互联网。仅和相邻路由器交换当前路由器所知道的全部信息，即自己的路由表。每30s广播一次RIP路由更新信息，以便自动建立并维护路由表。超过180s没有收到相邻路由器的更新表，将改路由器标为不可达。<strong>好消息传递快，坏消息传递慢</strong>，当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是ospf">什么是<code>OSPF</code> ？<a href="#什么是ospf" class="hash-link" aria-label="Direct link to 什么是ospf" title="Direct link to 什么是ospf">​</a></h3>
<p>#IGP #链路状态路由算法 #网络层 #IP数据报<a href="https://zhuanlan.zhihu.com/p/41341540" target="_blank" rel="noopener noreferrer">OSPF</a>每个路由器将已知的链路状态信息以<strong>组播</strong>方式向该区域的其他路由器发送<strong>IP协议包</strong>通告，网络上的每台路由器对网络结构都会有相同的认识。</p>
<ol>
<li>
<p><strong>邻接表</strong>：列出每台路由器全部已经建立邻接关系的邻居路由器</p>
</li>
<li>
<p><strong>链路状态数据库</strong>：列出网络中其他路由器的信息，显示全网拓扑，在全网范围中是一致的（链路状态数据库的同步）</p>
</li>
<li>
<p><strong>路由表</strong>：每个路由根据链路状态数据库使用Dijkstra SPF最短路径算法计算从自己到各目的网络的最优路径，不存储完整路径，只存储下一跳地址，构造新得路由表。</p>
</li>
<li>
<p>向本AS中所有路由器发送信息，洪泛法（可靠的洪泛法，收到更新分组后需要返回确认）</p>
</li>
<li>
<p>发送的信息是<strong>邻接表</strong>，不发送全部已知信息。</p>
</li>
<li>
<p>链路状态发生变化时，路由器才用洪泛法发送信息，并且更新过程收敛的快，不会出现RIP中坏消息传的慢的问题。</p>
</li>
<li>
<p>对不同的链路根据IP分组的不同服务类型（TOS）设置不同的<strong>代价</strong>，对于不同类型的业务可计算出不同的路由，十分灵活。高带宽的卫星链路对于非实时业务可以设置为较低的代价，但是对于时延敏感的业务可以设置非常高的代价。</p>
</li>
<li>
<p>如果到一个目的网络有多条代价相同的路径，那么可以将通信量分配给这几条路径，称为多路经间的<strong>负载平衡</strong>。</p>
</li>
<li>
<p>支持可变长度的<strong>子网划分 和无分类编址CIDR</strong></p>
</li>
<li>
<p>每个链路状态都带上一个32b的序号，序号越大，状态就越新。</p>
</li>
<li>
<p>为了保证全网状态一致，OSPF规定每隔一段时间刷新一次数据库中的链路状态，链路状态带上一个32b的序号用来比较状态是否最新</p>
</li>
<li>
<p>将AS划分为若干更小的区域，洪泛法交换链路状态信息的范围局限在每个区域中而非整个自治系统。减少了整个网络上的通信量。每个区域内的路由器只知道本区域的完整网络拓扑。</p>
</li>
<li>
<p>问候分组：发现和维持邻站的<strong>可达性</strong>，每两个相邻的路由器每个10s要交换一次问候分组，40秒后更新链路状态数据库不可达。</p>
</li>
<li>
<p>数据库描述分组：向邻站给出自己的链路状态数据库中所有链路状态项目的摘要信息</p>
</li>
<li>
<p>链路状态请求分组：项对方请求发送某些链路状态项目的详细信息</p>
</li>
<li>
<p>链路状态更新分组：用洪泛法对全网更新链路状态</p>
</li>
<li>
<p>链路状态确认分组：对链路更新分组的确认</p>
</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是bgp">什么是<code>BGP</code>？<a href="#什么是bgp" class="hash-link" aria-label="Direct link to 什么是bgp" title="Direct link to 什么是bgp">​</a></h3>
<p>#EGP外部网关协议 #路径向量路由选择协议 #TCP #应用层<em>路径向量路由选择协议，基于TCP的应用层协议</em>一个AS选择一个或多个路由器作为BGP发言人，AS之间的BGP发言人交换路由信息，要先建立TCP连接（BGP报文是通过TCP传送的，BGP报文是TCP报文的数据部分），在此连接上，交换BGP报文建立BGP会话，再利用BGP会话交换路由信息边界路由器之间的会话都是通过TCP连接传送BGP报文。内部叫iBGP，外部叫eBGP。某一个边界路由器会通过iBGP向AS内的其他边界路由器共享那些通过eBGP从其他AS的边界路由器得到的信息。AS的iBGP必须是全连通的。</p>
<ol>
<li>
<p>BGP交换路由信息的结点数量级是自治系统的数量级，比这些自治系统中的网络数少很多</p>
</li>
<li>
<p>每个AS的BGP发言人很少。</p>
</li>
<li>
<p>BGP<strong>支持CIDR</strong>，因此BGP的路由表也就应当包括<strong>目录网络前缀</strong>，<strong>下一跳路由器</strong>，以及到达该目的网络所要经过的各个<strong>AS序列</strong></p>
</li>
<li>
<p>BGP刚运行时，BGP的邻站交换整个BGP路由表，但以后只需在发生变化时更新有变化的部分，节省网络带宽，减少路由器的处理开销</p>
</li>
<li>
<p>打开报文：用来与相邻的另一个BGP发言人建立关系</p>
</li>
<li>
<p>更新报文：用来发送某一路由的信息，以及列出要撤消的多条路由（BGP核心）</p>
</li>
<li>
<p>保活报文：用来确认打开报文并周期性地证实邻站关系</p>
</li>
<li>
<p>通知报文：用来发送监测到的差错</p>
</li>
</ol>
<p>‍</p>
<h1>分组转发</h1>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="fragment转发过程和地址匹配"><code>fragment</code>转发过程和地址匹配？<a href="#fragment转发过程和地址匹配" class="hash-link" aria-label="Direct link to fragment转发过程和地址匹配" title="Direct link to fragment转发过程和地址匹配">​</a></h3>
<p>链路层只能看到MAC帧<em>转发表</em>中每条路必须有下面两条信息：{目的网络（前缀匹配），下一跳地址（接口）}</p>
<ol>
<li>
<p>基于终点的转发, 路由器只根据目的站IP地址转发，与源站无关</p>
</li>
<li>
<p>主机路由，特定主机路由，32个1的IP地址。a.b.c.d/32，主机路由在转发表中都放在最前面</p>
</li>
<li>
<p>默认路由，在实际转发表中用一个特殊前缀0.0.0.0/0相匹配。</p>
</li>
<li>
<p>为了减少路由器中的项目数，采用<em>地址聚合技术</em>，把三个地址聚合块聚 合为一个地址</p>
</li>
<li>
<p>在采用CIDR编址时，如果一个分组在转发表中可以找到多个匹配的前缀，那么应当选择前缀最长的一个作为匹配的前缀，这个原则称为最长前缀匹配，其地址块就越小，因而路由越具体。</p>
</li>
<li>
<p>转发表按前缀长的放在前面</p>
</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是arp">什么是<code>ARP</code>？<a href="#什么是arp" class="hash-link" aria-label="Direct link to 什么是arp" title="Direct link to 什么是arp">​</a></h3>
<p>[[ARP|地址解析协议]] #网络层协议 #ARP数据单元被封装在以太帧APR用于解决同一个局域网上的主机或路由器的IP地址和MAC地址的映射问题。IP地址到MAC地址的映射，<strong>询问目标IP对应的MAC地址</strong>每一台主机都设有一个<strong>ARP高速缓存</strong>，存放一个从IP地址到MAC地址的映射表，这些都是该主机目前知道的一些MAC地址的情况，并且这个映射表还会经常动态更新（新增或者超时删除）。ARP高速缓存中的每一个映射项目都设置生存时间（10-20分钟），防止目标主机的网络适配器随机损坏。<strong>广播请求，单播回应</strong>：ARP请求分组时广播，ARP响应分组时单播。</p>
<p>那么，什么是广播？对于初学者而言，我们只需要知道，大部分的广播包，它们有一个共同特征：<strong>二层封装时目的MAC是全f（ffff.ffff.ffff）或三层封装时目的IP是全1（255.255.255.255）</strong> 。可以这样更方便的记住：目的地址最大的，就是广播。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是icmp">什么是<code>ICMP</code>？<a href="#什么是icmp" class="hash-link" aria-label="Direct link to 什么是icmp" title="Direct link to 什么是icmp">​</a></h3>
<p>#网际控制报文协议 #网络层协议 #不可靠为了更有效的转发IP数据报和提高交付成功的机会，允许主 机和路由器报告差错情况和提供有关异常情况的报告。ICMP报文虽然装在IP数据报中，但不是高层协议，而是IP层协议。<strong>ICMP报文作为IP层数据报的数据</strong>，加上数据报的首部，组成IP数据报发送出去。用于 TCP/IP 网络中发送控制消息，提供可能发生在通信环境中的各种问题反馈，通过这些信息，使网络管理者可以对所发生的问题作出诊断，然后采取适当的措施解决问题。</p>
<ol>
<li>
<p>差错报文：终点不可达报文（路由器或主机不能交付数据时,向源点发出的报文），源点抑制报文（路由器或主机由于拥塞而丢弃数据报时（不再使用）），时间超过报文（路由器收到生存时间TTL=0的数据报时，除了丢弃该报外，向源点发送时间超过报文），参数问题报文（路由器或目的主机收到的报文首部有的字段值不正确），改变路由（重定向）报文（路由器把改变路由报文发送给主机，下此应将数据报发送给另外的路由器（可通过更好的路由））。不发送差错报文的情况：对ICMP差错报文不再发送差错报告报文；对第一个分片的数据报片的所有后续数据报片不发送ICMP差错报告报文；对具有组播数据的数据报不再发送差错数据报文；对具有特殊地址（127.0.0.0,0.0.0.0 ）不再发送ICMP差错报告报文</p>
</li>
<li>
<p>询问报文：回送请求和回答报文，时间戳请求和回答报文，地址掩码请求和回答报文，路由器询问和回答报文</p>
</li>
</ol>
<p><code>ping/traceroute</code> 命令是基于 <code>ICMP</code> 协议来实现的，PING工作在应用层，直接使用网络层的ICMP（回送请求和回答报文），而未使用传输层的TCP和UDP。Traceroute/tracert工作在网络层，发送数据报（时间超过报文），利用TTL逐次+1发送，获取到达目的主机所经过的路由器的IP地址，以及到达每个路由器的往返时间。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是dhcp">什么是<code>DHCP</code>？<a href="#什么是dhcp" class="hash-link" aria-label="Direct link to 什么是dhcp" title="Direct link to 什么是dhcp">​</a></h3>
<p>[[DHCP|动态主机配置协议]] #应用层协议 #UDP #C/S常用于给主机动态分配IP地址，提供了即插即用的联网机制，这种机制允许一台计算机加入新的网络和获取IP地址，而不用手工参与。</p>
<ul>
<li>
<p>用于内部网路或网络服务供应商自动分配<a href="https://zh.wikipedia.org/wiki/IP%E5%9C%B0%E5%9D%80" target="_blank" rel="noopener noreferrer">IP地址</a>给用户</p>
</li>
<li>
<p>用于内部网路管理员对所有电脑作中央管理DHCP使网络管理员能从中心结点监控和分配IP地址。当某台计算机移到网络中的其它位置时，能自动收到新的IP地址。租约：计算机IP地址的有效期。租用时间是不定的，主要取决于用户在某地连接Internet需要多久，这对于教育行业和其它用户频繁改变的环境是很实用的。透过较短的租期，DHCP能够在一个计算机比可用IP地址多的环境中动态地重新配置网络。DHCP支持为计算机分配静态地址，如需要永久性IP地址的Web服务器。</p>
</li>
</ul>
<h1>分组转发</h1>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="过程">过程<a href="#过程" class="hash-link" aria-label="Direct link to 过程" title="Direct link to 过程">​</a></h2>
<p>链路层只能看到MAC帧</p>
<ol>
<li>
<p>基于终点的转发</p>
</li>
<li></li>
<li>
<p>IP层抽象的互联网上只能看到IP数据报，首部中的源地址和目的地址始终一致，分别为IP1,和IP2.路由器IP地址不出现在IP数据报的首部</p>
</li>
<li>
<p>路由器只根据目的站IP地址转发，与源站无关</p>
</li>
<li>
<p>转发表中每条路必须有下面两条信息：{目的网络（前缀匹配），下一跳地址（接口）}（如何找到下一跳路由器的  地址？）</p>
</li>
<li>
<p>最长前缀匹配：</p>
</li>
<li></li>
<li>
<p>为了减少路由器中的项目数，采用地址聚合技术，把三个地址聚合块聚合为一个地址</p>
</li>
<li>
<p>在采用CIDR编址时，如果一个分组在转发表中可以找到多个匹配的前缀，那么应当选择前缀最长的一个作为匹配的前缀，这个原则称为最长前缀匹配，其地址块就越小，因而路由越具体。</p>
</li>
<li>
<p>转发表按前缀长的放在前面</p>
</li>
<li>
<p>主机路由，特定主机路由，32个1的IP地址。a.b.c.d/32，主机路由在转发表中都放在最前面</p>
</li>
<li>
<p>默认路由，在实际转发表中用一个特殊前缀0.0.0.0/0相匹配。</p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arp---地址解析协议">ARP - 地址解析协议<a href="#arp---地址解析协议" class="hash-link" aria-label="Direct link to ARP - 地址解析协议" title="Direct link to ARP - 地址解析协议">​</a></h2>
<p>路由器或主机如何知道应当在MAC帧首部填入的MAC帧地址？</p>
<p>APR用于解决同一个局域网上的主机或路由器的IP地址和MAC地址的映射问题。</p>
<p>IP地址到MAC地址的映射，<strong>询问目标IP对应的MAC地址</strong></p>
<p><strong>这就好比我们要寄一个快递，如果在快递单上仅仅写了收件人的姓名（IP），却没有写收件人的地址（MAC），那么这个快递就没法寄出，因为信息不完整。</strong></p>
<p>主机的ARP高速缓存中存放一个从IP地址到MAC地址的映射表，并且这个映射表还会经常动态更新（新增或者超时删除）</p>
<p>每一台主机都设有一个ARP高速缓存，ARP cache，里面存有本局域网中各主机和路由器的IP地址到MAC地址的映射表，这些都是该主机目前知道的一些MAC地址的情况</p>
<p>ARP高速缓存中的每一个映射项目都设置生存时间（10-20分钟），防止目标主机的网络适配器随机损坏  。</p>
<p><strong>广播请求，单播回应</strong></p>
<p>那么，什么是广播？对于初学者而言，我们只需要知道，大部分的广播包，它们有一个共同特征：<strong>二层封装时目的MAC是全f（ffff.ffff.ffff）或三层封装时目的IP是全1（255.255.255.255）</strong>。可以这样更方便的记住：目的地址最大的，就是广播。</p>
<table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>发送方</td><td>接收方</td><td>过程</td></tr><tr><td>主机</td><td>本网络主机</td><td>ARP找到目的地址的MAC地址</td></tr><tr><td>主机</td><td>其他网络主机</td><td>ARP找到和本网连接的路由器MAC地址，剩余工作由该路由器完成</td></tr><tr><td>路由器</td><td>连接网络的主机</td><td>在该网络中找到ARP找到目的主机的MAC地址</td></tr><tr><td>路由器</td><td>非连接网络的主机</td><td>路由器找到与非连接网络连接的路由器的MAC地址，再由该路由器完成剩余工作</td></tr></tbody></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="icmp---网际控制报文协议">ICMP - 网际控制报文协议<a href="#icmp---网际控制报文协议" class="hash-link" aria-label="Direct link to ICMP - 网际控制报文协议" title="Direct link to ICMP - 网际控制报文协议">​</a></h2>
<p>为了更有效的转发IP数据报和提高交付成功的机会，允许主机和路由器报告差错情况和提供有关异常情况的报告。</p>
<p>ICMP报文虽然装在IP数据报中，但不是高层协议，而是IP层协议。ICMP报文作为IP层数据报的数据，加上数据报的首部，组成IP数据报发送出去。</p>
<p>网络层协议 ping/traceroute 命令是基于 ICMP 协议来实现的</p>
<p>用于 TCP/IP 网络中发送控制消息，提供可能发生在通信环境中的各种问题反馈，通过这些信息，使网络管理者可以对所发生的问题作出诊断，然后采取适当的措施解决问题。</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>差错报文</td><td>1. 终点不可达报文:路由器或主机不能交付数据时,向源点发出的报文</td></tr></tbody></table>
<ol start="2">
<li>源点抑制报文:路由器或主机由于拥塞而丢弃数据报时（不再使用）</li>
<li>时间超过报文:路由器收到生存时间TTL=0的数据报时，除了丢弃该报外，向源点发送时间超过报文</li>
<li>参数问题报文：路由器或目的主机收到的报文首部有的字段值不正确</li>
<li>改变路由（重定向）报文：路由器把改变路由报文发送给主机，下此应将数据报发送给另外的路由器（可通过更好的路由）|
|不发送差错报文的情况|1. ICMP差错报文不再发送差错报告报文</li>
<li>对第一个分片的数据报片的所有后续数据报片不发送ICMP差错报告报文</li>
<li>对具有组播数据的数据报不再发送差错数据报文</li>
<li>对具有特殊地址（127.0.0.0,0.0.0.0 ）不再发送ICMP差错报告报文|
|询问报文|1. 回送请求和回答报文</li>
<li>时间戳请求和回答报文</li>
<li>地址掩码请求和回答报文</li>
<li>路由器询问和回答报文|</li>
</ol>
<p>PING工作在应用层，直接使用网络层的ICMP，而未使用传输层的TCP和UDP</p>
<p>Traceroute/tracert工作在网络层，发送数据报，利用TTL逐次+1发送，获取到达目的主机所经过的路由器的IP地址，以及到达每个路由器的往返时间</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dhcp-host-configuration-protocol">DHCP<!-- -->:Dynamic<!-- --> Host Configuration Protocol<a href="#dhcp-host-configuration-protocol" class="hash-link" aria-label="Direct link to dhcp-host-configuration-protocol" title="Direct link to dhcp-host-configuration-protocol">​</a></h2>
<p><strong>使用C/S模式，基于UDP的应用层协议</strong></p>
<p>常用于给主机动态分配IP地址，提供了即插即用的联网机制，这种机制允许一台计算机加入 新的网络和获取IP地址，而不用手工参与。</p>
<ul>
<li>
<p>用于内部网路或网络服务供应商自动分配<a href="https://zh.wikipedia.org/wiki/IP%E5%9C%B0%E5%9D%80" target="_blank" rel="noopener noreferrer">IP地址</a>给用户</p>
</li>
<li>
<p>用于内部网路管理员对所有电脑作中央管理</p>
</li>
</ul>
<p>原理：使用C/S模式，需要IP地址的主机在启动时就向DHCP服务器广播发送发现报文，该主机就成为DHCP客户，本地网络的所有主机都能收到此广播报文，但只有DHCP服务器才回答此报文，DHCP服务器先在其数据库中查找该计算机的配置信息，若找到返回信息，若找不到，从服务器中的IP地址池中取一个地址分配给该计算机，回答报文称提供报文。</p>
<p>DHCP使网络管理员能从中心结点监控和分配IP地址。当某台计算机移到网络中的其它位置时，能自动收到新的IP地址。</p>
<p>DHCP使用了租约的概念，或称为计算机IP地址的有效期。租用时间是不定的，主要取决于用户在某地连接Internet需要多久，这对于教育行业和其它用户频繁改变的环境是很实用的。透过较短的租期，DHCP能够在一个计算机比可用IP地址多的环境中动态地重新配置网络。DHCP支持为计算机分配静态地址，如需要永久性IP地址的Web服务器。</p>
<h1>路由选择</h1>
<p>算法必须正确完整，计算简单，有自适应性，能适应通信量和网络拓扑的变化，具有稳定性，公平，最佳（相对某一种特定要求下得出的较为合理的选择）</p>
<p>互联网规模非常大，让所有的路由器知道所有的网络怎么到达不现实。</p>
<p>许多单位不愿意将自己单位的网络的布局细节和本部门所采用的路由选择协议让外界知道</p>
<p>AS：Autonomous System</p>
<ol>
<li>
<p>单一技术管理下的一组路由器，这些路由器使用一种AS内部的路由选择协议和共同的度量来确定分组在该AS  内的路由，同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由。</p>
</li>
<li>
<p>一个自治系统内的所有网络都由一个行政单位（政府部门，公司、大学）管辖，一个自治系统的所有路由器在自治系统内都是必须联通的。</p>
</li>
</ol>
<p>路由算法就是让路由知道收到报文之后下一步怎么走</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>静态路由（非自适应性算法）</td><td>网络管理员手工配置路由信息，不能及时适应网络状态变换优点：简便，开销小，拓扑变化不大的小网络中运行效果好缺点：不能及时适应网络状态变化</td></tr><tr><td>动态路由（自适应性）</td><td>路由器上的路由表项通过相互连接的路由器之间彼此交换信息，按照一定算法优化出来。路由信息在一定时间间隙不断更新，适应不断变化的网络，随时获得最优寻路效果。优点：改善网络性能，有助于流量控制缺点：算法复杂，增加网络负担，反应太快引起动荡，反应太慢影响网络的一致性</td></tr></tbody></table>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>按协议工作机制划分</td><td>协议</td></tr><tr><td>距离矢量协议</td><td>RIP特点：直接把自己的路由表更新给邻居，路由器之间交互各自路由表，来学习或记录自己没有的。</td></tr><tr><td>链路状态协议</td><td>OSPF、IS-IS特点：传递的是描述拓扑的信息叫链路状态信息，通过泛洪和收集这些信息，每台路由器可以进行拓扑数据库的构建，这个数据库就相当于对整个拓扑的理解，基于这个理解每台路由器进行单独算法计算，以自己为根，产生出一个最短路径树。</td></tr><tr><td>路径向量协议</td><td>BGP采用</td></tr></tbody></table>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>按工作范围划分</td><td>协议</td></tr><tr><td>IGP  （AS内）</td><td>RIP、OSPF、IS-ISIGP是工作在AS内，叫自治域系统，由一个独立的机构所统一管理的运行相同路由协议类型和策略一组路由器所构成的网络，说白了就类似于一家公司的网络。</td></tr><tr><td>EGP（AS之间）</td><td>BGPESP是工作在AS之间，使能交互路由信息</td></tr></tbody></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rip">RIP<a href="#rip" class="hash-link" aria-label="Direct link to RIP" title="Direct link to RIP">​</a></h2>
<p>基于距离向量的路由选择协议。</p>
<p><a href="https://juejin.cn/post/7022536969003466782" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7022536969003466782</a></p>
<p>RIP是Routing Information Protocol（路由信息协议）的简称，它是一种较为简单的内部网关协议（Interior Gateway Protocol）。RIP是一种分布式的基于距离矢量（Distance-Vector）算法的协议，它使用跳数作为度量来衡量到达目的网络的距离。RIP包括RIP-1和RIP-2两个版本，RIP-2对RIP-1进行了扩充，使其更具有优势。RIP基于UDP，通过UDP报文进行路由信息的交换，端口号520。定期更新整张路由表，依照传闻；距离矢量路由协议并不了解网络拓扑。RIP三个版本RIPv1、RIPv2、RIPng（为IPv6开发）。RIP版本1是广播发送，版本2是组播发送</p>
<p><em>使用距离矢量路由协议的路由器并不了解网络的拓扑。这是基于“传闻”的更新。</em></p>
<p>RIP协议是依照传闻的更新，采用逐条的动作。邻居将路由表更新给我，我先去更新本地的路由表，然后再向外更新自己的路由表。</p>
<ol>
<li>
<p>规定</p>
</li>
<li></li>
<li>
<p>每个R都要维护从它自身到其他每个目的网络的距离记录（因此者这是一组距离，距离向量）</p>
</li>
<li>
<p>距离也称跳数Hoop Count，规定从一个路由器到直接连接网络的距离为1,而每经过一个路由器，距离跳数+1</p>
</li>
<li>
<p>RIP认为好的路由就是他通过的路由器数目少，即优先选择跳数少的路径，不考虑带宽</p>
</li>
<li>
<p>RIP允许一条路经最多只能包含15个路由器，因此距离等于16时，表示网路不可达，可见RIP之能适用于小型互联网，规定路径上的最高跳数的目的是为了防止数据报不断循环在环路上，减少拥堵的可能性</p>
</li>
<li>
<p>RIP默认在任意两个使用RIP的路由器之间每30s广播一次RIP路由更新信息，以便自动建立并维护路由表</p>
</li>
<li>
<p>在RIP中不支持子网掩码的RIP广播，所以RIP中每个网络的子网掩码必须相同，但在新的RIP2中，支持变长子网掩码和CIDR。</p>
</li>
<li>
<p>特点</p>
</li>
<li></li>
<li>
<p>仅和相邻路由器交换信息</p>
</li>
<li>
<p>路由器交换的信息是当前路由器所知道的全部信息，即自己的路由表</p>
</li>
<li>
<p>按固定的时间间隔交换路由信息，如每个30s</p>
</li>
<li>
<p>坏消息传递慢，当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。</p>
</li>
<li>
<p>好消息传递快。</p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ospf">OSPF<a href="#ospf" class="hash-link" aria-label="Direct link to OSPF" title="Direct link to OSPF">​</a></h2>
<p>开放最短路径优先，为了克服RIP的缺点</p>
<p><a href="https://zhuanlan.zhihu.com/p/41341540" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/41341540</a></p>
<p>链路状态路由协议使用SPF最短路经优先算法（shortest path first spf）计算和选择路由，这类路由协议只关心网络中链路或接口的状态（up down ip地址，掩码带宽，利用率和时延等），每个路由器将已知的链路状态信息向该区域的其他路由器通告，通过这种方式，网络上的每台路由器对网络结构都会有相同的认识，随后路由器以其为依据，使用spf算法计算和选择路由</p>
<p>spf算法：是以自身为根节点计算出一棵最短路径树，在这棵树上由根到各节点的累计开销最小，即由根到各节点的路径在整个网络中都是最优的，这样也就获得了由根去往各个节点的路由。</p>
<p>ospf引入router id概念，ospf区域内的每台路由器的行为都能很好的被跟踪</p>
<p><strong>OSPF的三张表</strong></p>
<ol>
<li>
<p>邻居列表：列出每台路由器全部已经建立邻接关系的邻居路由器</p>
</li>
<li>
<p>链路状态数据库：列出网络中其他路由器的信息，由此显示了全网的网络拓扑，实际是全网的拓扑结构图，在全网范围中是一致的（链路状态数据库的同步）</p>
</li>
<li>
<p>路由表：每个路由根据链路状态数据库使用Dijkstra SPF最短路径算法计算从自己到各目的网络的最优路径，构造新得路由表</p>
</li>
</ol>
<p><strong>特点</strong></p>
<ol>
<li>
<p>向本AS中所有路由器发送信息，洪泛法（可靠的洪泛法，收到更新分组后需要返回确认）</p>
</li>
<li>
<p>发送的信息是<strong>本路由器相邻路由的信息</strong>，是本路由器知道的部分信息，链路状态説明本路由器和哪些路由器相邻及该链路的度量（代价）。</p>
</li>
<li>
<p>链路状态发生变化时，路由器才用洪泛法发送信息，并且更新过程收敛的快，不会出现RIP中坏消息传的慢的问题</p>
</li>
<li>
<p>OSPF是纯网络层协议，不适用UDP或TCP，而直接用IP数据报传送（其IP数据报的首部协议字段是89），RIP是应用层协议，他在传输层才用UDP</p>
</li>
<li>
<p>对不同的链路根据IP分组的不同服务类型（TOS）设置不同的代价，对于不同类型的业务可计算出不同的路由，十分灵活</p>
</li>
<li></li>
<li>
<p>高带宽的卫星链路对于非实时业务可以设置为较低的代价，但是对于时延敏感的业务可以设置非常高的代价</p>
</li>
<li>
<p>如果到一个目的网  络有多条代价相同的路径，那么可以将通信量分配给这几条路径，称为多路经间的负载平衡。</p>
</li>
<li>
<p>支持可变长度的子网划分和无分类编址CIDR</p>
</li>
<li>
<p>每个链路状态都带上一个32b的序号，序号越大，状态就越新。</p>
</li>
<li>
<p><em>所有在OSPF的路由之间交换的分组具有鉴别功能，因而保证了仅在可信赖的路由器之间交换链路状态信息</em></p>
</li>
<li>
<p>为了保证全网状态一致，OSPF规定每隔一段时间刷新一次数据库中的链路状态，链路状态带上一个32b的序号用来比较状态是否最新</p>
</li>
</ol>
<p><strong>协议报文</strong></p>
<ol>
<li>
<p>问候分组：发现和维持邻站的可达性，每两个相邻的路由器每个10s要交换一次问候分组，40秒后更新链路状态数据库不可达。</p>
</li>
<li>
<p>数据库描述分组：向邻站给出自己的链路状态数据库中所有链路状态项目的摘要信息</p>
</li>
<li>
<p>链路状态请求分组：项对方请求发送某些链路状态项目的详细信息</p>
</li>
<li>
<p>链路状态更新分组：用洪泛法对全网更新链路状态</p>
</li>
<li>
<p>链路状态确认分组：对链路更新分组的确认</p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bgp-4">BGP-4<a href="#bgp-4" class="hash-link" aria-label="Direct link to BGP-4" title="Direct link to BGP-4">​</a></h2>
<p>不同AS的路由器之间交换路由信息的协议，外部网关协议</p>
<p><em>路径向量路由选择协议，基于TCP的应用层协议</em></p>
<p><strong>工作原理</strong></p>
<p>一个AS选择一个或多个路由器作为BGP发言人，AS之间的BGP发言人交换路由信息，要先建立TCP连接（BGP报文是通过TCP传送的，BGP报文是TCP报文的数据部分），在此连接上，交换BGP报文建立BGP会话，再利用BGP会话交换路由信息</p>
<p>边界路由器之间的会话都是通过TCP连接传送BGP报文。内部叫iBGP，外部叫eBGP。某一个边界路由器会通过iBGP向AS内的其他边界路由器共享那些通过eBGP从其他AS的边界路由器得到的信息。AS的iBGP必须是全连通的。</p>
<p>找下一跳。</p>
<p>特点</p>
<ol>
<li>
<p>BGP交换路由信息的结点数量级是自治系统的数量级，比这些自治系统中的网络数少很多</p>
</li>
<li>
<p>每个AS的BGP发言人很少。</p>
</li>
<li>
<p>BGP支持CIDR，因此BGP的路由表也就应当包括目录网络前缀，下一跳路由器BGP的起点，以及到达该目的网络所要经过的各个AS序列</p>
</li>
<li>
<p>BGP刚运行时，BGP的邻站交换整个BGP路由表，但以后只需在发生变化时更新有变化的部分，节省网络带宽，减少路由器的处理开销</p>
</li>
</ol>
<p><strong>协议报文</strong></p>
<ol>
<li>
<p>打开报文：用来与相邻的另一个BGP发言人建立关系</p>
</li>
<li>
<p>更新报文：用来发送某一路由的信息，以及列出要撤消的多条路由（BGP核心）</p>
</li>
<li>
<p>保活报文：用来确认打开报文并周期性地证实邻站关系</p>
</li>
<li>
<p>通知报文：用来发送监测到的差错</p>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wangenius/wangenius.github.io/tree/master/docs/cs/web/路由器原理.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/cs/web/网络设备"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">hub</div></a></nav></div><div>Loading Comments...</div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#---siderbar_position--3" class="table-of-contents__link toc-highlight">‍---
siderbar_position : 3</a><ul><li><a href="#路由表和转发表的区别" class="table-of-contents__link toc-highlight">路由表和转发表的区别？</a></li><li><a href="#路由选择和分组转发" class="table-of-contents__link toc-highlight">路由选择和分组转发</a></li><li><a href="#什么是路由选择" class="table-of-contents__link toc-highlight">什么是路由选择？</a></li><li><a href="#什么是rip" class="table-of-contents__link toc-highlight">什么是<code>RIP</code>？</a></li><li><a href="#什么是ospf" class="table-of-contents__link toc-highlight">什么是<code>OSPF</code>？</a></li><li><a href="#什么是bgp" class="table-of-contents__link toc-highlight">什么是<code>BGP</code>？</a></li><li><a href="#fragment转发过程和地址匹配" class="table-of-contents__link toc-highlight"><code>fragment</code>转发过程和地址匹配？</a></li><li><a href="#什么是arp" class="table-of-contents__link toc-highlight">什么是<code>ARP</code>？</a></li><li><a href="#什么是icmp" class="table-of-contents__link toc-highlight">什么是<code>ICMP</code>？</a></li><li><a href="#什么是dhcp" class="table-of-contents__link toc-highlight">什么是<code>DHCP</code>？</a></li></ul></li><li><a href="#过程" class="table-of-contents__link toc-highlight">过程</a></li><li><a href="#arp---地址解析协议" class="table-of-contents__link toc-highlight">ARP - 地址解析协议</a></li><li><a href="#icmp---网际控制报文协议" class="table-of-contents__link toc-highlight">ICMP - 网际控制报文协议</a></li><li><a href="#dhcp-host-configuration-protocol" class="table-of-contents__link toc-highlight">DHCP Host Configuration Protocol</a></li><li><a href="#rip" class="table-of-contents__link toc-highlight">RIP</a></li><li><a href="#ospf" class="table-of-contents__link toc-highlight">OSPF</a></li><li><a href="#bgp-4" class="table-of-contents__link toc-highlight">BGP-4</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">知识库</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/about/致明日的舞">致明日的舞</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/cs/os/概述">操作系统基础</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/dsa/ds/概述">数据结构</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/lang/rust/简介">Rust</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/cs/db/概述">数据库</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weibo.com/u/6320492937" target="_blank" rel="noopener noreferrer" class="footer__link-item">微博<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/247967944" target="_blank" rel="noopener noreferrer" class="footer__link-item">bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.zhihu.com/people/wangenius" target="_blank" rel="noopener noreferrer" class="footer__link-item">知乎<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/wangenius" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/about/关于我">关于我</a></li><li class="footer__item"><a class="footer__link-item" href="/en/blog">博客</a></li><li class="footer__item"><a href="https://github.com/wangenius/wangenius.github.io/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">讨论<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/wangenius/wangenius.github.io/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 吕麓弥章, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>